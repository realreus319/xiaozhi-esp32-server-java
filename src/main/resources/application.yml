# ============================================================
# 通用配置（所有环境共享）
# ============================================================

server:
  port: 8091

# ============================================================
# MyBatis 配置
# ============================================================
mybatis:
  mapper-locations: classpath*:com/xiaozhi/mapper/*.xml

# ============================================================
# 数据源配置
# ============================================================
spring:
  datasource:
    type: com.zaxxer.hikari.HikariDataSource
    hikari:
      minimum-idle: 10
      maximum-pool-size: 100
      auto-commit: true
      idle-timeout: 300000
      pool-name: DatebookHikariCP
      max-lifetime: 1800000
      connection-timeout: 30000
      connection-test-query: SELECT 1
      validation-timeout: 5000
      leak-detection-threshold: 60000
      keepalive-time: 30000
      register-mbeans: true

  # Redis 缓存配置
  cache:
    type: redis

  data:
    redis:
      # Redis 服务器地址（Spring Data Redis 和 Redisson 自动共享此配置）
      host: localhost
      port: 6379
      database: 0
      # Redisson 高级配置文件（可选，用于连接池、超时等高级设置）
      redisson:
        config: classpath:redisson-config.yml

  # 禁用Groovy模板位置检查
  groovy:
    template:
      check-template-location: false

  # 文件上传配置
  servlet:
    multipart:
      enabled: true
      max-file-size: 20480MB
      max-request-size: 20480MB

  # JMX 配置
  jmx:
    enabled: false

  # WebSocket 配置
  websocket:
    allowed-origins: '*'

  # Session 配置
  session:
    cookie:
      http-only: true
      secure: false
      same-site: lax
      path: /

  # 虚拟线程
  threads:
    virtual:
      enabled: true

  # 静态资源配置
  web:
    resources:
      add-mappings: true

  # 激活的配置文件（默认为开发环境）
  profiles:
    active: dev

# ============================================================
# 日志配置
# ============================================================
logging:
  level:
    root: INFO
    org.springframework: INFO
    io.github.imfangs.dify.client.impl.StreamEventDispatcher: ERROR
    io.netty.handler: ERROR

# ============================================================
# SpringDoc OpenAPI 配置
# ============================================================
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    url: /v3/api-docs

# ============================================================
# Sa-Token 认证框架配置
# ============================================================
sa-token:
  # Token名称 (同时也是cookie名称)
  token-name: Authorization

  # Token有效期 (单位:秒) 30天 = 2592000秒, -1表示永不过期
  timeout: 2592000

  # Token最低活跃频率 (单位:秒), 如果token超过此时间没有访问系统就会被冻结, -1 表示不限制
  active-timeout: -1

  # 是否允许同一账号多地同时登录 (为true时允许一起登录, 为false时新登录挤掉旧登录)
  is-concurrent: true

  # 在多人登录同一账号时,是否共用一个token (为true时所有登录共用一个token, 为false时每次登录新建一个token)
  is-share: false

  # Token风格 (uuid、simple-uuid、random-32、random-64、random-128、tik)
  token-style: uuid

  # 是否输出操作日志
  is-log: false

  # 是否从cookie中读取token
  is-read-cookie: true

  # 是否从header中读取token
  is-read-header: true

  # token前缀, 例如填写 Bearer 之后客户端应该发送: Bearer {token}
  token-prefix: Bearer

  # JWT秘钥 (使用JWT Simple模式时必须配置，至少32位)
  jwt-secret-key: xiaozhi-esp32-server-java-jwt-secret-key

# ============================================================
# 自定义配置
# ============================================================
# 是否定时关闭不活跃的会话（秒）
check:
  inactive:
    session: true
